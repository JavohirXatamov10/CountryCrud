<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>addDistrict</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>
<div class="row mt-4">
    <div class="col-4 offset-4">
        <div class="card p-2">
            <h1>Add District</h1>
            <form  th:action="|/district/addDistrict|" method="post">
                <input  name="name" class="form-control my-3" style="width: 100%" type="text" placeholder="Name">
                <select id="selectCountry" onchange="CountryAndRegion()" name="countryId" class="form-control my-3">
                    <option disabled selected>Choose Country</option>
                    <option th:each="country : ${countries}"
                            th:value="${country.id}"
                            th:text="${country.name}"></option>
                </select>
                <select id="selectRegion" name="regionId" class="form-control my-3">
                    <option disabled selected>Choose Region </option>
                </select>
                <div class="text-center">
                    <button class="btn btn-dark btn-lg w-100">Add District</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    function CountryAndRegion() {
        let select = document.getElementById("selectCountry");
        let countryId = select.value;
        let selectRegion = document.getElementById("selectRegion");
        selectRegion.innerHTML = "<option disabled selected>Choose Region</option>";
        const url = "/findRegion/getRegions/" + countryId;
        fetch(url, {
            method:"GET"
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (!data || data.length === 0) {
                    throw new Error('No regions found for the selected country');
                }
                console.log(data)
                selectRegion.innerHTML = "<option disabled selected>Choose Region</option>";
                data.forEach(region => {
                    let option = document.createElement("option");
                    option.value = region.id;
                    option.text = region.name;
                    selectRegion.appendChild(option);
                });
            })
            .catch(error => console.error("Error fetching regions:", error));
    }
</script>
</body>
</html>